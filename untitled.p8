pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
function _init()
	-- cls(0)
	cls(1)
	poke( 0x5f2e, 1 )
	pal( {[0]=0,1,2,131,4,5,6,7,8,9,138,139,12,13,14,15}, 1 )
	drawiso()
	drawdepth()
	-- copy()



	-- drawgrid()
--	drawframe()
	-- sspr(88,0,16,16,0,0,32,16)
end

function _draw()
	rectfill(0,0,128,30,1)
	-- swap()
	-- spr(0,0,0,16,4)
	-- spr(64,0,64,16,4)
	-- unswap()
	drawiso()

	palt(14, true)
	palt(0, false)
	spr(34,69,18,2,2)
	spr(36,33,23,2,2, true)
	palt()

	local t=mid(0,t()/2%1.4-.2,1)
	outline("+2", 72,16-lerp(0,10,quad(t)))
	outline("+1", 36,21-lerp(0,10,quad(t)))


	rectfill(0,120,127,127,8)
	print('cpu:'..stat(1),2,122,2)
end

-- function _update()
-- end

-- function drawframe()
-- 	line(0,0,128,0,8)
-- 	line(0,127,127,127,8)
-- 	line(0,0,0,127,8)
-- 	line(127,0,127,127,8)
-- end

-- function drawgrid()
-- 	offi=16
-- 	offj=16
-- 	for i=0,4 do
-- 		for j=0,4 do
-- 			-- rectfill(14*j+offj,14*i+offi,14*j+14+offj,14*i+14+offi, 7)
-- 			-- sspr(88,0,16,16,16*j+8,16*i+8,32,16)
-- 			-- sspr(16,0,16,16,16*j+8,16*i+8)
-- 			offj+=4
-- 		end
-- 		offi+=4
-- 		offj=16
-- 	end
-- end

function drawiso()
	x=54
	y=2
	z=5
	for i=0,8 do
		if i%2==0 then
			pal(12,139)
		else
			pal(12,138)
		end
		for j=0,i do
			if i < 5 or j < z then
				-- sspr(32,0,16,16,24*j+x,8+24*i-y,24,24)
				sspr(88,0,16,16,24*j+x,8+32*i-y,32,16)
			end
		end
		y+=26
		if i < 4 then
			x-=12
		else
			x+=12
			z-=1
		end
	end
end

function drawdepth()
	x=6
	y=37
	for i=0,4 do
		if i%2==0 then
			pal(12,131)
		else
			pal(12,139)
		end
		spr(13, x+12*i, y+6*i, 2, 2)
		spr(13, 114-x-12*i, y+6*i, 2, 2, true)
	end
end

function outline(txt, x, y)
	offs={-1,0,1}
	for i=1,3 do
		for j=1,3 do
			print(txt,x+offs[i],y+offs[j],7)
		end
	end
	print(txt,x,y,0)
end

-- function pd_rotate(x,y,rot,mx,my,w,flip,scale)
--   local step = 1/16
--   scale=scale or 1
--   rot=rot\step * step
--   local halfw, cx=scale*-w/2, mx + .5
--   local cy,cs,ss=my-halfw/scale,cos(rot)/scale,sin(rot)/scale
--   local sx, sy, hx, hy=cx+cs*halfw, cy+ss*halfw, w*(flip and -4 or 4)*scale, w*4*scale
--   for py=y-hy, y+hy do
--   tline(x-hx, py, x+hx, py, sx -ss*halfw, sy + cs*halfw, cs/8, ss/8)
--   halfw+=.125
--   end
-- end

function quad(t)
	t-=.5
	return .5-t*t*2
end

function lerp(a,b,t)
    return a+(b-a)*t
end

function copy()
-- copy spritesheet to upper memory
	-- memcpy(0x4300,0x0000,1000)
 -- copy screen to upper memory
	memcpy(0x4300,0x6000,2000)
end


function swap()
	-- copy spritesheet to upper memory
	memcpy(0x8000,0x0000,2000)
	-- copy upper memory to spritesheet
	memcpy(0x0000,0x4300,2000)
end

function unswap()
	memcpy(0x4300,0x0000,2000)
	memcpy(0x0000,0x8000, 2000)
end
__gfx__
0000000000000000ccccccccccccccca0000000000000000000000000000000000000000ccc999ccc999ccc000000c0000000000cc0000000000000000000000
0000000000888880c0000000000000080000000000000000000000000000000000000000ccc999ccc999ccc00000ccc000000000cccc00000000000000000000
0000000008888888c0000000000000080000000000000000000000000000000000000000ccc999ccc999ccc0000ccccc00000000cccccc000000000000000000
0000000000080088c00000000000000800000000000000000000000000000000c9c9c000999ccc999ccc999000ccccccc0000000cccccccc0000000000000000
0000000000080088c000000000000008000000000000000000000000000000009c9c9000999ccc999ccc99900ccccccccc000000cccccccccc00000000000000
0000000008808880c00000000000000800000000000000000000000000000000c9c9c000999ccc999ccc9990ccccccccccc0000000cccccccccc000000000000
0000000008888800c000000000000008000000000000000000000000000000009c9c9000ccc999ccc999ccc0ccccccccccc000000000cccccccc000000000000
0000000008080800c0000000000000080000000cc00000000000000770000000c9c9c000ccc999ccc999ccc00ccccccccc000000000000cccccc000000000000
0000000000000000c00000000000000800000cccccc00000000007700770000000000000ccc999ccc999ccc000ccccccc000000000000000cccc000000000000
0000000000000000c000000000000008000cccccccccc000000770000007700000000000999ccc999ccc9990000ccccc000000000000000000cc000000000000
0000000000000000c0000000000000080cccccccccccccc0077000000000077000000000999ccc999ccc99900000ccc000000000000000000000000000000000
0000000000000000c000000000000008cccccccccccccccc700000000000000700000000999ccc999ccc999000000c0000000000000000000000000000000000
0000000000000000c0000000000000080cccccccccccccc0077000000000077000000000ccc999ccc999ccc00000000000000000000000000000000000000000
0000000000000000c000000000000008000cccccccccc000000770000007700000000000ccc999ccc999ccc00000000000000000000000000000000000000000
0000000000000000c00000000000000800000cccccc00000000007700770000000000000ccc999ccc999ccc00000000000000000000000000000000000000000
0000000000000000a8888888888888880000000cc000000000000007700000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee00000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000eeeeeee66eeeeeeeeeeeeeeeeeeeeeee00000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000eeeee66dd66eeeeeeeeee888888eeeee00000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000eee66dddddd66eeeeeee88888822eeee00000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000ee6dddddddddd1eeeee8878888882eee00000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000ee511dddddd116eeee887888888822ee00000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000ee05511dd11661eeee888888888222ee00000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000cc0000000e115055116616ddeee888828222222ee00000000000000000000000000000000000000000000000000000000000000000000000000000000
00000cccccc00000e5511505616dd66eeee8222222222eee00000000000000000000000000000000000000000000000000000000000000000000000000000000
000cccccccccc000e55551156dd6666eeeeed222222deeee00000000000000000000000000000000000000000000000000000000000000000000000000000000
0cccccccccccccc0e5155551d666606eeeeefdddddddeeee00000000000000000000000000000000000000000000000000000000000000000000000000000000
cccccccccccccccce50515556660616eeeeefffffffdeeee00000000000000000000000000000000000000000000000000000000000000000000000000000000
0cccccccccccccc0e50505156061616eeeeeff1ffffdeeee00000000000000000000000000000000000000000000000000000000000000000000000000000000
000cccccccccc000eee5050561616eeeeeeeff1ffdfdeeee00000000000000000000000000000000000000000000000000000000000000000000000000000000
00000cccccc00000eeeee505616eeeeeeeeefffff1fdeeee00000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000cc0000000eeeeeee56eeeeeeeeeeeeffff1feeeee00000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000100001e0001f0001f0001f0001f0001f0001f0001f0001f000230002a000320003a0003d0003d0003d0003c000350002d000250002b0002c0002a000280002700025000170000000000000000000000000000
